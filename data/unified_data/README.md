# Creating the database
The database can be generated by running two files: `create_db.py` and `populate_db.py`.  
1. Move to the repo folder (the db writing process uses files in `src`)  
```$ cd ../../```
2. Run the database creation script. A .db file will be created in `/data/unified_data/pythonsqlite.db`  
```$ python data/unified_data/create_db.py```
3. Populate the db  
```$ python data/unified_data/populate_db.py```

# Database schema
https://dbdiagram.io/d/5dd39b82edf08a25543e16d0

# Sample commands
For now the db is a sqlite file living in the data folder. Might need connection to a hosted db in the future. To connect to sqlite with sqlite3:  
`$ sqlite3 /data/unified_data/pythonsqlite.db`  
View all tables:  
`> .tables`  
View table schema:  
`> .schema tablename`
1.  Extract an arbitary question and its answer given a qn id.  
```
SELECT query_string, raw_string  
FROM labeled_queries  
INNER JOIN kb_clauses  
ON labeled_queries.clause_id=kb_clauses.id  
WHERE labeled_queries.id=50 ;

NEW
SELECT query_string, raw_string 
FROM query_db 
INNER JOIN query_labels 
ON query_db.id=query_labels.query_id 
INNER JOIN kb_clauses 
ON query_labels.clause_id=kb_clauses.id 
WHERE query_db.id=1;
```  
2.  View the number of clauses in each document
```
SELECT kb_name, count(processed_string) 
FROM kb_clauses 
INNER JOIN kb_raw 
ON kb_clauses.raw_id=kb_raw.id
GROUP by kb_name;
```
3.  Extract all clauses of a single document
```
SELECT processed_string 
FROM kb_clauses 
INNER JOIN kb_raw 
ON kb_clauses.raw_id=kb_raw.id 
WHERE kb_name='other-insurance';
```
4.  Extract all qns relating to a single document.
```
SELECT distinct query_string 
FROM labeled_queries 
INNER JOIN kb_clauses 
ON kb_clauses.id=labeled_queries.clause_id 
INNER JOIN kb_raw 
ON kb_clauses.raw_id=kb_raw.id 
WHERE kb_raw.kb_name='other-insurance';

NEW
SELECT distinct query_string 
FROM query_db 
INNER JOIN query_labels 
ON query_db.id=query_labels.query_id
INNER JOIN kb_clauses
ON query_labels.clause_id=kb_clauses.id 
INNER JOIN kb_raw 
ON kb_clauses.raw_id=kb_raw.id 
WHERE kb_raw.kb_name='other-insurance';
```
# Data sources
## 1. Insurance QnA
source: https://github.com/shuzi/insuranceQA  
Before inserting dataset into db, clone and unzip from source
```
git clone https://github.com/shuzi/insuranceQA.git
gzip -r ./insuranceQA/V2/
```
## 2. PDPA FAQ
data in `/data/pdpa.csv`